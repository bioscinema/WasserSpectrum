% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/shape_contrast_test.R
\name{shape_contrast_test}
\alias{shape_contrast_test}
\title{Shape Contrast Test for Wasserstein Spectrum (Multiclass GLS)}
\usage{
shape_contrast_test(spectrum_obj, t_vec, contrast_t, contrast_group = NULL)
}
\arguments{
\item{spectrum_obj}{An object returned by \code{\link{wasserstein_spectrum_multiclass}},
containing basis expansion, estimated coefficients, and covariance matrix.}

\item{t_vec}{A numeric vector of quantile levels \(t_1, \dots, t_m\) over which to define the shape contrast.}

\item{contrast_t}{A numeric vector of weights (length \(m\)) defining the shape contrast over quantiles.
This vector should typically sum to zero for pure shape comparisons.}

\item{contrast_group}{Optional group contrast matrix or vector (default is global test across all groups).
Each row defines a linear contrast across groups. Rows should sum to 0 for pairwise interpretation.}
}
\value{
A list containing:
\item{statistic}{Wald test statistic based on the specified contrast.}
\item{df}{Degrees of freedom for the chi-squared test (equal to number of contrast rows).}
\item{p_value}{P-value from the chi-squared distribution.}
\item{delta_shape}{Contrast-weighted effect estimates across all groups.}
\item{cov_shape}{Covariance matrix of \code{delta_shape}.}
\item{contrast_group}{The contrast matrix used to compare groups.}
\item{estimate}{Final linear contrast estimate (e.g., group difference in shape).}
\item{cov_estimate}{Covariance matrix of the final contrast estimate.}
}
\description{
Performs a Wald-type test for shape-based contrasts of group-specific spectrum curves
using a linear combination of quantile levels and group contrasts.
}
\details{
This function enables formal comparison of the *shape* of spectrum curves (e.g., U-shape vs. linear shift)
across groups using user-defined weights over quantiles (\code{contrast_t}) and across groups
(\code{contrast_group}). The test statistic is computed as a Wald quadratic form:
\deqn{
\theta^\top \mathrm{Var}^{-1}(\theta) \theta,
}
where \(\theta = C_g C_t^\top \Phi(t)\hat\beta\).

If \code{contrast_group} is not provided, a global test across all groups is conducted.
}
\examples{
\dontrun{
# U-shaped contrast over quantiles
t_vec <- seq(0.1, 0.9, length.out = 5)
contrast_t <- c(1, -0.5, -1, -0.5, 1)

# Test difference in U-shape between two groups
contrast_group <- c(1, -1, 0)  # group 1 vs group 2

result <- shape_contrast_test(spectrum_obj = fit,
                              t_vec = t_vec,
                              contrast_t = contrast_t,
                              contrast_group = contrast_group)
print(result$p_value)
}

}
