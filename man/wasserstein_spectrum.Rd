% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/wasserstein_spectrum.R
\name{wasserstein_spectrum}
\alias{wasserstein_spectrum}
\title{Wasserstein Spectrum Regression via Generalized Least Squares (GLS)}
\usage{
wasserstein_spectrum(
  df,
  diversity_col,
  outcome_col,
  confounder_cols = NULL,
  basis_df = 6,
  t_grid = seq(0.01, 0.99, length.out = 100),
  alpha = 0.05,
  plot = TRUE,
  seed = 123
)
}
\arguments{
\item{df}{A data frame containing the alpha diversity values, exposure variable, and optional confounders.}

\item{diversity_col}{A string specifying the column name containing the continuous alpha diversity index.}

\item{outcome_col}{A string specifying the name of the exposure variable (binary or numeric).}

\item{confounder_cols}{Optional character vector of column names to adjust for as covariates (default is \code{NULL}).}

\item{basis_df}{Degrees of freedom used for the B-spline basis in quantile expansion (default is 6).
Use smaller values (e.g., 4â€“5) when sample size is small to avoid overfitting.}

\item{t_grid}{Numeric vector of quantile levels \eqn{t \in (0,1)} to evaluate along the diversity distribution
(default is 100 equally spaced points between 0.01 and 0.99).}

\item{alpha}{Significance level for confidence intervals (default is 0.05).}

\item{plot}{Logical. If \code{TRUE}, plots the estimated coefficient curve and confidence bands (default is \code{TRUE}).}

\item{seed}{Random seed for reproducibility (default is 123).}
}
\value{
A list with the following components:
\item{quantiles}{Vector of quantile levels \(t\) used in the regression.}
\item{beta1}{Estimated exposure effect \(\hat{\beta}_1(t)\) across the quantile spectrum.}
\item{se1}{Robust standard errors for \(\hat{\beta}_1(t)\).}
\item{lower}{Lower bound of the \((1 - \alpha)\)-level confidence interval.}
\item{upper}{Upper bound of the \((1 - \alpha)\)-level confidence interval.}
\item{basis}{The B-spline basis matrix used for quantile expansion.}
\item{coef}{Full GLS coefficient vector for all basis-covariate combinations.}
\item{vcov}{Robust sandwich variance-covariance matrix for the estimated coefficients.}
\item{idx_x}{Index of the exposure variable in the model matrix.}
\item{basis_df}{Degrees of freedom used for the spline basis.}
}
\description{
Estimates the quantile-varying exposure effect on alpha diversity using functional regression.
This method fits a generalized least squares model with basis expansion over quantile levels,
allowing for smooth inference on the coefficient function \eqn{\beta_1(t)} with robust standard errors.
}
\details{
The function approximates the conditional quantile function of diversity using a B-spline basis
over quantile levels and fits a linear model to binary indicators of whether diversity exceeds
each quantile threshold. The resulting effect curve \(\hat{\beta}_1(t)\) characterizes how an
exposure influences different portions of the diversity distribution.

Robust standard errors are calculated using heteroskedasticity-consistent estimators to account
for residual correlation across quantile levels.
}
\examples{
\dontrun{
result <- wasserstein_spectrum(df = example_df,
                                   diversity_col = "Shannon",
                                   outcome_col = "BMI",
                                   confounder_cols = c("Age", "Sex"))
plot(result$quantiles, result$beta1, type = "l")
}

}
